<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>fritz!box data volume report</title>
    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"> </script>
    <script src="//cdn.jsdelivr.net/npm/@js-joda/core@1.11.0/dist/js-joda.js"></script>

    <script>

        function appendTimeFrame(fileName, selector) {
            $.getJSON(fileName, function(data) {
                const localIpVolumes = Object.keys(data.local).reduce((acc, localIp) => {
                    acc.push({ localIp, ...data.local[localIp] });
                    return acc;
                }, []);
                localIpVolumes.sort((a, b) => b.download - a.download);
                $.each(localIpVolumes, function(idx, entry) {
                    var tblRow = "<tr>" +
                        "<td>" + entry.localIp + "</td>" +
                        "<td align=\"right\">" + entry.download.toLocaleString("de") + "</td>" +
                        "<td align=\"right\">" + entry.upload.toLocaleString("de") + "</td>" +
                        "</tr>";
                    $(tblRow).appendTo(selector);
                });
            });
        }

        $(function() {
            const HOUR_FORMAT = JSJoda.DateTimeFormatter.ofPattern('uuuu-MM-dd-HH');
            const DAY_FORMAT = JSJoda.DateTimeFormatter.ofPattern('uuuu-MM-dd');
            const MONTH_FORMAT = JSJoda.DateTimeFormatter.ofPattern('uuuu-MM');
            const zonedDateTime = JSJoda.ZonedDateTime.now();

            const currentHourFileName = zonedDateTime.format(HOUR_FORMAT) + '.json';
            appendTimeFrame(currentHourFileName, "#currentHour tbody");

            const lastHourFileName = zonedDateTime.minusHours(1).format(HOUR_FORMAT) + '.json';
            appendTimeFrame(lastHourFileName, "#lastHour tbody");

            const todayFileName = zonedDateTime.format(DAY_FORMAT) + '.json';
            appendTimeFrame(todayFileName, "#today tbody");

            const yesterdayFileName = zonedDateTime.minusDays(1).format(DAY_FORMAT) + '.json';
            appendTimeFrame(yesterdayFileName, "#yesterday tbody");

            const currentMonthFileName = zonedDateTime.format(MONTH_FORMAT) + '.json';
            appendTimeFrame(currentMonthFileName, "#currentMonth tbody");

            const lastMonthFileName = zonedDateTime.minusMonths(1).format(MONTH_FORMAT) + '.json';
            appendTimeFrame(lastMonthFileName, "#lastMonth tbody");
        });
    </script>
</head>
<body>
<div class="wrapper">
    <div class="profile">
        <H3>Current hour</H3>
        <table id="currentHour" border="2">
            <thead>
                <th>Local IP</th><th>Download</th><th>Upload</th>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    <div class="profile">
        <H3>Last hour</H3>
        <table id="lastHour" border="2">
            <thead>
                <th>Local IP</th><th>Download</th><th>Upload</th>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    <div class="profile">
        <H3>Today</H3>
        <table id="today" border="2">
            <thead>
                <th>Local IP</th><th>Download</th><th>Upload</th>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    <div class="profile">
        <H3>Yesterday</H3>
        <table id="yesterday" border="2">
            <thead>
                <th>Local IP</th><th>Download</th><th>Upload</th>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    <div class="profile">
        <H3>Current Month</H3>
        <table id="currentMonth" border="2">
            <thead>
                <th>Local IP</th><th>Download</th><th>Upload</th>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    <div class="profile">
        <H3>Last Month</H3>
        <table id="lastMonth" border="2">
            <thead>
                <th>Local IP</th><th>Download</th><th>Upload</th>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>
</body>
</html>
